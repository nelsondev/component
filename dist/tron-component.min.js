/*!
 * Tron Component v1.0.0
 * Ultra-simple reactive web component library
 * (c) 2024 Nelson M
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TronComponent={})}(this,function(t){"use strict";const e=Symbol.for("preact-signals");function n(){if(r>1)return void r--;let t,e=!1;for(;void 0!==o;){let n=o;for(o=void 0,h++;void 0!==n;){const i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&l(n))try{n.c()}catch(n){e||(t=n,e=!0)}n=i}}if(h=0,r--,e)throw t}let i,o;function s(t){const e=i;i=void 0;try{return t()}finally{i=e}}let r=0,h=0,c=0;function u(t){if(void 0===i)return;let e=t.n;return void 0===e||e.t!==i?(e={i:0,S:t,p:i.s,n:void 0,t:i,e:void 0,x:void 0,r:e},void 0!==i.s&&(i.s.n=e),i.s=e,t.n=e,32&i.f&&t.S(e),e):-1===e.i?(e.i=0,void 0!==e.n&&(e.n.p=e.p,void 0!==e.p&&(e.p.n=e.n),e.p=i.s,e.n=void 0,i.s.n=e,i.s=e),e):void 0}function d(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function a(t,e){return new d(t,e)}function l(t){for(let e=t.s;void 0!==e;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function f(t){for(let e=t.s;void 0!==e;e=e.n){const n=e.S.n;if(void 0!==n&&(e.r=n),e.S.n=e,e.i=-1,void 0===e.n){t.s=e;break}}}function p(t){let e,n=t.s;for(;void 0!==n;){const t=n.p;-1===n.i?(n.S.U(n),void 0!==t&&(t.n=n.n),void 0!==n.n&&(n.n.p=t)):e=n,n.S.n=n.r,void 0!==n.r&&(n.r=void 0),n=t}t.s=e}function v(t,e){d.call(this,void 0),this.x=t,this.s=void 0,this.g=c-1,this.f=4,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function y(t){const e=t.u;if(t.u=void 0,"function"==typeof e){r++;const o=i;i=void 0;try{e()}catch(e){throw t.f&=-2,t.f|=8,_(t),e}finally{i=o,n()}}}function _(t){for(let e=t.s;void 0!==e;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,y(t)}function S(t){if(i!==this)throw new Error("Out-of-order effect");p(this),i=t,this.f&=-2,8&this.f&&_(this),n()}function w(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function m(t){const e=new w(t);try{e.c()}catch(t){throw e.d(),t}const n=e.d.bind(e);return n[Symbol.dispose]=n,n}function g(t,e){return Array.isArray(e)?function(t,e){const n=a([...e]);return n.render=function(t){return this.value.map((e,n)=>"function"==typeof t?t(e,n):t).join("")},["push","pop","shift","unshift","splice","sort","reverse"].forEach(t=>{n[t]=function(...e){const n=[...this.value],i=n[t](...e);return this.value=n,i}}),n.valueOf=function(){return this.value},n.toString=function(){return JSON.stringify(this.value)},m(()=>{n.value,t.isConnected&&t._scheduleUpdate()}),t._reactives.set(n,!0),n}(t,e):function(t,e){const n=a(e);return n.update=function(){return this.value=this.value,this},n.valueOf=function(){return this.value},n.toString=function(){return String(this.value)},m(()=>{n.value,t.isConnected&&t._scheduleUpdate()}),t._reactives.set(n,!0),n}(t,e)}function b(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function E(t,e){if(null==t)return t;switch(e){case Boolean:return"true"===t||!0===t||""===t;case Number:const n=Number(t);return isNaN(n)?0:n;case Array:case Object:if("string"==typeof t)try{return JSON.parse(t)}catch{return e===Array?[]:{}}return t;default:return String(t)}}function C(t){return{react:e=>g(t,e),element:t,event(e,n=null){const i=n||"_evt"+t._eventCounter++;t[i]=(...t)=>e(...t);const o=(...e)=>t[i](...e);return o.valueOf=o.toString=()=>{const t=e.toString();if(!/^\s*\(\s*[^)]+\s*\)/.test(t))return`this.getRootNode().host.${i}()`;return t.includes(",")?`this.getRootNode().host.${i}(event)`:`(function(e){e.preventDefault();this.getRootNode().host.${i}(e)}).call(this,event)`},o},props:e=>function(t,e){const n={},i={};return e.forEach(t=>{const e="string"==typeof t?{name:t,type:String,default:""}:{type:String,default:"",...t};n[e.name]=e}),t.constructor.properties=n,t.constructor.observedAttributes=Object.keys(n).map(b),Object.keys(n).forEach(e=>{const o=n[e],s=b(e);Object.defineProperty(i,e,{get(){const n=t.getAttribute(s),i=null!==n?E(n,o.type):o.default;return o.required&&null==i&&console.warn(`Required prop '${e}' is missing on ${t.tagName}`),o.validator&&!o.validator(i)&&console.warn(`Invalid prop '${e}' value:`,i),i},set(n){if(o.validator&&!o.validator(n))return void console.warn(`Invalid prop '${e}' value:`,n);const i=E(n,o.type);t.setAttribute(s,i)}})}),t._props=i,i}(t,e),computed(e){const n={_fn:e,_cache:null,_dirty:!0,get value(){return this._dirty&&(this._cache=this._fn(),this._dirty=!1),this._cache}},i=t._scheduleUpdate;return t._scheduleUpdate=function(){n._dirty=!0,i.call(this)},n},render(e){t._template=e},onMounted(e){t.isConnected?e():t.addEventListener("mounted",e,{once:!0})},onUpdated(e){t.addEventListener("updated",e)},onBeforeUpdate(e){t.addEventListener("beforeUpdate",e)},onUnmounted(e){t.addEventListener("unmounted",e)}}}d.prototype.brand=e,d.prototype.h=function(){return!0},d.prototype.S=function(t){const e=this.t;e!==t&&void 0===t.e&&(t.x=e,this.t=t,void 0!==e?e.e=t:s(()=>{var t;null==(t=this.W)||t.call(this)}))},d.prototype.U=function(t){if(void 0!==this.t){const e=t.e,n=t.x;void 0!==e&&(e.x=n,t.e=void 0),void 0!==n&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n,void 0===n&&s(()=>{var t;null==(t=this.Z)||t.call(this)}))}},d.prototype.subscribe=function(t){return m(()=>{const e=this.value,n=i;i=void 0;try{t(e)}finally{i=n}})},d.prototype.valueOf=function(){return this.value},d.prototype.toString=function(){return this.value+""},d.prototype.toJSON=function(){return this.value},d.prototype.peek=function(){const t=i;i=void 0;try{return this.value}finally{i=t}},Object.defineProperty(d.prototype,"value",{get(){const t=u(this);return void 0!==t&&(t.i=this.i),this.v},set(t){if(t!==this.v){if(h>100)throw new Error("Cycle detected");this.v=t,this.i++,c++,r++;try{for(let t=this.t;void 0!==t;t=t.x)t.t.N()}finally{n()}}}}),v.prototype=new d,v.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===c)return!0;if(this.g=c,this.f|=1,this.i>0&&!l(this))return this.f&=-2,!0;const t=i;try{f(this),i=this;const t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return i=t,p(this),this.f&=-2,!0},v.prototype.S=function(t){if(void 0===this.t){this.f|=36;for(let t=this.s;void 0!==t;t=t.n)t.S.S(t)}d.prototype.S.call(this,t)},v.prototype.U=function(t){if(void 0!==this.t&&(d.prototype.U.call(this,t),void 0===this.t)){this.f&=-33;for(let t=this.s;void 0!==t;t=t.n)t.S.U(t)}},v.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(let t=this.t;void 0!==t;t=t.x)t.t.N()}},Object.defineProperty(v.prototype,"value",{get(){if(1&this.f)throw new Error("Cycle detected");const t=u(this);if(this.h(),void 0!==t&&(t.i=this.i),16&this.f)throw this.v;return this.v}}),w.prototype.c=function(){const t=this.S();try{if(8&this.f)return;if(void 0===this.x)return;const t=this.x();"function"==typeof t&&(this.u=t)}finally{t()}},w.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,y(this),f(this),r++;const t=i;return i=this,S.bind(this,t)},w.prototype.N=function(){2&this.f||(this.f|=2,this.o=o,o=this)},w.prototype.d=function(){this.f|=8,1&this.f||_(this)},w.prototype.dispose=function(){this.d()};const x=new Map;let U=new Set,$=!1;function N(t,e){if(x.has(t))return console.warn(`Component ${t} already registered`),x.get(t);class n extends HTMLElement{static properties={};constructor(){super(),this.attachShadow({mode:"open"}),this._reactives=new Map,this._eventCounter=0,this._template=null,this._lastHTML="",this._firstRender=!0,this._updateScheduled=!1;const t=C(this);e.call(t,t)}connectedCallback(){this._applyStyles(),this._scheduleUpdate(),this.dispatchEvent(new CustomEvent("mounted"))}disconnectedCallback(){this._reactives.clear(),this.dispatchEvent(new CustomEvent("unmounted"))}attributeChangedCallback(t,e,n){e!==n&&this._props&&this._scheduleUpdate()}_scheduleUpdate(){!this._updateScheduled&&this.isConnected&&(this._updateScheduled=!0,function(t){U.add(t),$||($=!0,requestAnimationFrame(()=>{const t=[...U];U.clear(),$=!1,t.sort((t,e)=>{const n=t._isVisible();return e._isVisible()-n}),t.forEach(t=>{t.isConnected&&t._render()})}))}(this))}_render(){if(this._template){this._updateScheduled=!1,this.dispatchEvent(new CustomEvent("beforeUpdate"));try{const t="function"==typeof this._template?this._template():String(this._template);if(t===this._lastHTML&&!this._firstRender)return;this._firstRender?this._renderInitial(t):this._renderUpdate(t),this._lastHTML=t,this._firstRender=!1,this.dispatchEvent(new CustomEvent("updated"))}catch(e){console.error(`Error rendering ${t}:`,e)}}}_renderInitial(t){const e=this._getStyles(),n=e?`<style>${e}</style>${t}`:t;this.shadowRoot.innerHTML=n}_renderUpdate(t){var e,n;e=this.shadowRoot,n=t,e.innerHTML!==n&&(e.innerHTML=n)}_applyStyles(){const t=window.__tronStyles__;t instanceof CSSStyleSheet&&this.shadowRoot.adoptedStyleSheets&&(this.shadowRoot.adoptedStyleSheets=[t])}_getStyles(){const t=window.__tronStyles__;return t&&"string"==typeof t?t:null}_isVisible(){try{const t=this.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0}catch{return!0}}forceUpdate(){this._scheduleUpdate()}}return customElements.define(t,n),x.set(t,n),n}const T=new class{async init(t={}){const{stylesheets:e=[],cssText:n="",autoDetect:i=!1}=t;let o=n,s=[...e];if(i){const t=this._detectExistingStyles();o=t.css+"\n"+o,s=[...t.imports,...s]}o+=this._getBaseStyles();const r=this._combineStyles(s,o);if(this._supportsAdoptedStyleSheets()&&r)try{const t=new CSSStyleSheet;await t.replace(r),window.__tronStyles__=t}catch(t){window.__tronStyles__=r}else window.__tronStyles__=r;return this}_detectExistingStyles(){const t=[],e=[];try{Array.from(document.styleSheets).forEach(n=>{try{const e=n.cssRules||n.rules;e&&Array.from(e).forEach(e=>{e.cssText&&t.push(e.cssText)})}catch(t){n.href&&e.push(n.href)}})}catch(t){}return{css:t.join("\n"),imports:e}}_getBaseStyles(){return"\n/* Tron Component Base Styles */\n:host {\n  display: block;\n  box-sizing: border-box;\n}\n\n*, *::before, *::after {\n  box-sizing: inherit;\n}\n"}_combineStyles(t,e){const n=t.map(t=>`@import url('${t}');`).join("\n");return t.length>0?`${n}\n${e}`:e}_supportsAdoptedStyleSheets(){return"adoptedStyleSheets"in Document.prototype}};async function O(t={}){return await T.init(t),{component:R,init:O}}function R(t,e){return N(t,e)}"undefined"!=typeof window&&(window.component=R,window.TronComponent={component:R,init:O}),t.component=R,t.init=O});
