/*!
 * Tron Component v1.0.0
 * Ultra-simple reactive web component library
 * (c) 2024 Nelson M
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TronComponent={})}(this,function(t){"use strict";const e=Symbol.for("preact-signals");function i(){if(r>1)return void r--;let t,e=!1;for(;void 0!==o;){let i=o;for(o=void 0,h++;void 0!==i;){const n=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&a(i))try{i.c()}catch(i){e||(t=i,e=!0)}i=n}}if(h=0,r--,e)throw t}let n,o;function s(t){const e=n;n=void 0;try{return t()}finally{n=e}}let r=0,h=0,u=0;function c(t){if(void 0===n)return;let e=t.n;return void 0===e||e.t!==n?(e={i:0,S:t,p:n.s,n:void 0,t:n,e:void 0,x:void 0,r:e},void 0!==n.s&&(n.s.n=e),n.s=e,t.n=e,32&n.f&&t.S(e),e):-1===e.i?(e.i=0,void 0!==e.n&&(e.n.p=e.p,void 0!==e.p&&(e.p.n=e.n),e.p=n.s,e.n=void 0,n.s.n=e,n.s=e),e):void 0}function d(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function l(t,e){return new d(t,e)}function a(t){for(let e=t.s;void 0!==e;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function f(t){for(let e=t.s;void 0!==e;e=e.n){const i=e.S.n;if(void 0!==i&&(e.r=i),e.S.n=e,e.i=-1,void 0===e.n){t.s=e;break}}}function p(t){let e,i=t.s;for(;void 0!==i;){const t=i.p;-1===i.i?(i.S.U(i),void 0!==t&&(t.n=i.n),void 0!==i.n&&(i.n.p=t)):e=i,i.S.n=i.r,void 0!==i.r&&(i.r=void 0),i=t}t.s=e}function v(t,e){d.call(this,void 0),this.x=t,this.s=void 0,this.g=u-1,this.f=4,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function _(t){const e=t.u;if(t.u=void 0,"function"==typeof e){r++;const o=n;n=void 0;try{e()}catch(e){throw t.f&=-2,t.f|=8,y(t),e}finally{n=o,i()}}}function y(t){for(let e=t.s;void 0!==e;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_(t)}function S(t){if(n!==this)throw new Error("Out-of-order effect");p(this),n=t,this.f&=-2,8&this.f&&y(this),i()}function m(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function g(t){const e=new m(t);try{e.c()}catch(t){throw e.d(),t}const i=e.d.bind(e);return i[Symbol.dispose]=i,i}function C(t,e){return Array.isArray(e)?function(t,e){const i=l([...e]);return i.render=function(t){return this.value.map((e,i)=>"function"==typeof t?t(e,i):t).join("")},["push","pop","shift","unshift","splice","sort","reverse"].forEach(t=>{i[t]=function(...e){const i=[...this.value],n=i[t](...e);return this.value=i,n}}),i.valueOf=function(){return this.value},i.toString=function(){return JSON.stringify(this.value)},g(()=>{i.value,t.isConnected&&t._scheduleUpdate()}),t._reactives.set(i,!0),i}(t,e):function(t,e){const i=l(e);return i.update=function(){return this.value=this.value,this},i.valueOf=function(){return this.value},i.toString=function(){return String(this.value)},g(()=>{i.value,t.isConnected&&t._scheduleUpdate()}),t._reactives.set(i,!0),i}(t,e)}function w(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function b(t,e){if(null==t)return t;switch(e){case Boolean:return"true"===t||!0===t||""===t;case Number:const i=Number(t);return isNaN(i)?0:i;case Array:case Object:if("string"==typeof t)try{return JSON.parse(t)}catch{return e===Array?[]:{}}return t;default:return String(t)}}function E(t){return{react:e=>C(t,e),element:t,event(e,i=null){const n=i||"_evt"+t._eventCounter++;t[n]=(...t)=>e(...t),t._eventHandlers.add(n);const o=(...e)=>t[n](...e);return o.valueOf=o.toString=()=>{const t=e.toString();if(!/^\s*\(\s*[^)]+\s*\)/.test(t))return`this.${n}()`;return t.includes(",")?`this.${n}(event)`:`(function(e){e.preventDefault();this.${n}(e)}).call(this,event)`},o},props:e=>function(t,e){const i={},n={};return t._propsCache=new Map,e.forEach(t=>{const e="string"==typeof t?{name:t,type:String,default:""}:{type:String,default:"",...t};i[e.name]=e}),t.constructor.properties=i,t.constructor.observedAttributes=Object.keys(i).map(w),Object.keys(i).forEach(e=>{const o=i[e],s=w(e);Object.defineProperty(n,e,{get(){if(t._propsCache.has(e))return t._propsCache.get(e);const i=t.getAttribute(s),n=null!==i?b(i,o.type):o.default;return o.required&&null==n&&console.warn(`Required prop '${e}' is missing on ${t.tagName}`),o.validator&&!o.validator(n)&&console.warn(`Invalid prop '${e}' value:`,n),t._propsCache.set(e,n),n},set(i){if(o.validator&&!o.validator(i))return void console.warn(`Invalid prop '${e}' value:`,i);const n=b(i,o.type);t.setAttribute(s,n)}})}),t._props=n,n}(t,e),computed:t=>function(t,e){return new v(t,e)}(t),render(e){t._template=e},onMounted(e){t.isConnected?e():t.addEventListener("mounted",e,{once:!0})},onUpdated(e){t.addEventListener("updated",e)},onBeforeUpdate(e){t.addEventListener("beforeUpdate",e)},onUnmounted(e){t.addEventListener("unmounted",e)}}}d.prototype.brand=e,d.prototype.h=function(){return!0},d.prototype.S=function(t){const e=this.t;e!==t&&void 0===t.e&&(t.x=e,this.t=t,void 0!==e?e.e=t:s(()=>{var t;null==(t=this.W)||t.call(this)}))},d.prototype.U=function(t){if(void 0!==this.t){const e=t.e,i=t.x;void 0!==e&&(e.x=i,t.e=void 0),void 0!==i&&(i.e=e,t.x=void 0),t===this.t&&(this.t=i,void 0===i&&s(()=>{var t;null==(t=this.Z)||t.call(this)}))}},d.prototype.subscribe=function(t){return g(()=>{const e=this.value,i=n;n=void 0;try{t(e)}finally{n=i}})},d.prototype.valueOf=function(){return this.value},d.prototype.toString=function(){return this.value+""},d.prototype.toJSON=function(){return this.value},d.prototype.peek=function(){const t=n;n=void 0;try{return this.value}finally{n=t}},Object.defineProperty(d.prototype,"value",{get(){const t=c(this);return void 0!==t&&(t.i=this.i),this.v},set(t){if(t!==this.v){if(h>100)throw new Error("Cycle detected");this.v=t,this.i++,u++,r++;try{for(let t=this.t;void 0!==t;t=t.x)t.t.N()}finally{i()}}}}),v.prototype=new d,v.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===u)return!0;if(this.g=u,this.f|=1,this.i>0&&!a(this))return this.f&=-2,!0;const t=n;try{f(this),n=this;const t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return n=t,p(this),this.f&=-2,!0},v.prototype.S=function(t){if(void 0===this.t){this.f|=36;for(let t=this.s;void 0!==t;t=t.n)t.S.S(t)}d.prototype.S.call(this,t)},v.prototype.U=function(t){if(void 0!==this.t&&(d.prototype.U.call(this,t),void 0===this.t)){this.f&=-33;for(let t=this.s;void 0!==t;t=t.n)t.S.U(t)}},v.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(let t=this.t;void 0!==t;t=t.x)t.t.N()}},Object.defineProperty(v.prototype,"value",{get(){if(1&this.f)throw new Error("Cycle detected");const t=c(this);if(this.h(),void 0!==t&&(t.i=this.i),16&this.f)throw this.v;return this.v}}),m.prototype.c=function(){const t=this.S();try{if(8&this.f)return;if(void 0===this.x)return;const t=this.x();"function"==typeof t&&(this.u=t)}finally{t()}},m.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,_(this),f(this),r++;const t=n;return n=this,S.bind(this,t)},m.prototype.N=function(){2&this.f||(this.f|=2,this.o=o,o=this)},m.prototype.d=function(){this.f|=8,1&this.f||y(this)},m.prototype.dispose=function(){this.d()};const x=new Map;function U(t,e){t.innerHTML!==e&&(t.innerHTML=e)}let H=new Set,L=!1;function M(t,e){if(x.has(t))return console.warn(`Component ${t} already registered`),x.get(t);class i extends HTMLElement{static properties={};constructor(){super(),this._reactives=new Map,this._eventHandlers=new Set,this._eventCounter=0,this._template=null,this._lastHTML="",this._firstRender=!0,this._updateScheduled=!1,this._originalContent=null,this._namedSlots={},this._hasSlots=!1,this._defaultSlotContent="";const t=E(this);e.call(t,t)}connectedCallback(){this._scheduleUpdate(),this.dispatchEvent(new CustomEvent("mounted"))}disconnectedCallback(){this._eventHandlers.forEach(t=>{delete this[t]}),this._eventHandlers.clear(),this._reactives.clear(),this.dispatchEvent(new CustomEvent("unmounted"))}attributeChangedCallback(t,e,i){e!==i&&this._props&&(this._propsCache&&this._propsCache.delete(t),this._scheduleUpdate())}_scheduleUpdate(){!this._updateScheduled&&this.isConnected&&(this._updateScheduled=!0,function(t){H.add(t),L||(L=!0,requestAnimationFrame(()=>{const t=[...H];H.clear(),L=!1,t.sort((t,e)=>{const i=t._isVisible();return e._isVisible()-i}),t.forEach(t=>{t.isConnected&&t._render()})}))}(this))}_render(){if(this._template){this._updateScheduled=!1,this.dispatchEvent(new CustomEvent("beforeUpdate"));try{const t="function"==typeof this._template?this._template():String(this._template);if(t===this._lastHTML&&!this._firstRender)return;U(this,this._processSlots(t)),this._lastHTML=t,this._firstRender=!1,this.dispatchEvent(new CustomEvent("updated"))}catch(e){console.error(`Error rendering ${t}:`,e)}}}_render(){if(this._template){this._updateScheduled=!1,this.dispatchEvent(new CustomEvent("beforeUpdate"));try{const t="function"==typeof this._template?this._template():String(this._template);if(t===this._lastHTML&&!this._firstRender)return;U(this,this._processSlots(t)),this._lastHTML=t,this._firstRender=!1,this.dispatchEvent(new CustomEvent("updated"))}catch(e){console.error(`Error rendering ${t}:`,e)}}}_processSlots(t){return this._firstRender&&!this._originalContent&&(this._originalContent=this.innerHTML,this._namedSlots=this._extractNamedSlots(),this._hasSlots=t.includes("<slot"),this._defaultSlotContent=this._getDefaultSlotContent()),this._hasSlots?t.replace(/<slot(\s+name=["']([^"']+)["'])?[^>]*><\/slot>/g,(t,e,i)=>i?this._namedSlots[i]||"":this._defaultSlotContent):t}_extractNamedSlots(){const t={};if(!this._originalContent)return t;if(!this._originalContent.includes("slot="))return t;const e=document.createElement("div");return e.innerHTML=this._originalContent,e.querySelectorAll("[slot]").forEach(e=>{const i=e.getAttribute("slot");t[i]=e.outerHTML}),t}_getDefaultSlotContent(){if(!this._originalContent)return"";if(!this._originalContent.includes("slot="))return this._originalContent;const t=document.createElement("div");return t.innerHTML=this._originalContent,t.querySelectorAll("[slot]").forEach(t=>t.remove()),t.innerHTML}_isVisible(){try{const t=this.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0}catch{return!0}}forceUpdate(){this._scheduleUpdate()}}return customElements.define(t,i),x.set(t,i),i}function T(t,e){return M(t,e)}"undefined"!=typeof window&&(window.component=T,window.TronComponent={component:T}),t.component=T});
