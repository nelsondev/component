/*!
 * Tron Component v1.0.0
 * Ultra-simple reactive web component library
 * (c) 2024 Nelson M
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TronComponent={})}(this,function(t){"use strict";const e=Symbol.for("preact-signals");function n(){if(r>1)return void r--;let t,e=!1;for(;void 0!==s;){let n=s;for(s=void 0,h++;void 0!==n;){const i=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&a(n))try{n.c()}catch(n){e||(t=n,e=!0)}n=i}}if(h=0,r--,e)throw t}let i,s;function o(t){const e=i;i=void 0;try{return t()}finally{i=e}}let r=0,h=0,c=0;function u(t){if(void 0===i)return;let e=t.n;return void 0===e||e.t!==i?(e={i:0,S:t,p:i.s,n:void 0,t:i,e:void 0,x:void 0,r:e},void 0!==i.s&&(i.s.n=e),i.s=e,t.n=e,32&i.f&&t.S(e),e):-1===e.i?(e.i=0,void 0!==e.n&&(e.n.p=e.p,void 0!==e.p&&(e.p.n=e.n),e.p=i.s,e.n=void 0,i.s.n=e,i.s=e),e):void 0}function l(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function d(t,e){return new l(t,e)}function a(t){for(let e=t.s;void 0!==e;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function f(t){for(let e=t.s;void 0!==e;e=e.n){const n=e.S.n;if(void 0!==n&&(e.r=n),e.S.n=e,e.i=-1,void 0===e.n){t.s=e;break}}}function p(t){let e,n=t.s;for(;void 0!==n;){const t=n.p;-1===n.i?(n.S.U(n),void 0!==t&&(t.n=n.n),void 0!==n.n&&(n.n.p=t)):e=n,n.S.n=n.r,void 0!==n.r&&(n.r=void 0),n=t}t.s=e}function v(t,e){l.call(this,void 0),this.x=t,this.s=void 0,this.g=c-1,this.f=4,this.W=null==e?void 0:e.watched,this.Z=null==e?void 0:e.unwatched}function _(t){const e=t.u;if(t.u=void 0,"function"==typeof e){r++;const s=i;i=void 0;try{e()}catch(e){throw t.f&=-2,t.f|=8,y(t),e}finally{i=s,n()}}}function y(t){for(let e=t.s;void 0!==e;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_(t)}function S(t){if(i!==this)throw new Error("Out-of-order effect");p(this),i=t,this.f&=-2,8&this.f&&y(this),n()}function m(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}function C(t){const e=new m(t);try{e.c()}catch(t){throw e.d(),t}const n=e.d.bind(e);return n[Symbol.dispose]=n,n}function g(t,e){return Array.isArray(e)?function(t,e){const n=d([...e]);n.render=function(t){return this.value.map((e,n)=>"function"==typeof t?t(e,n):t).join("")},["push","pop","shift","unshift","splice","sort","reverse"].forEach(t=>{n[t]=function(...e){const n=this.value[t](...e);return this.value=[...this.value],n}}),n.valueOf=function(){return this.value},n.toString=function(){return JSON.stringify(this.value)};const i=C(()=>{n.value,t.isConnected&&t._scheduleUpdate()});return n.dispose=i,t._reactives.set(n,!0),n}(t,e):function(t,e){const n=d(e);n.update=function(){return this.value=this.value,this},n.valueOf=function(){return this.value},n.toString=function(){return String(this.value)};const i=C(()=>{n.value,t.isConnected&&t._scheduleUpdate()});return n.dispose=i,t._reactives.set(n,!0),n}(t,e)}function w(t){return t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}function b(t,e){if(null==t)return t;switch(e){case Boolean:return"true"===t||!0===t;case Number:const n=Number(t);return isNaN(n)?0:n;case Array:case Object:if("string"==typeof t)try{return JSON.parse(t)}catch{return e===Array?[]:{}}return t;default:return String(t)}}function E(t){return{react:e=>g(t,e),element:t,event(e,n=null){const i=n||"_evt"+t._eventCounter++;t[i]=(...t)=>e(...t),t._eventHandlers.add(i);const s=(...e)=>t[i](...e);return s.valueOf=s.toString=()=>{const t=e.toString();if(!/^\s*\(\s*[^)]+\s*\)/.test(t))return`this.${i}()`;return t.includes(",")?`this.${i}(event)`:`(function(e){e.preventDefault();this.${i}(e)}).call(this,event)`},s},addEventListener(e,n,i,s){e.addEventListener(n,i,s),t._eventListeners.add({element:e,type:n,handler:i})},props:e=>function(t,e){const n={},i={};return t._propsCache=new Map,e.forEach(t=>{const e="string"==typeof t?{name:t,type:String,default:""}:{type:String,default:"",...t};n[e.name]=e}),t.constructor.properties=n,t.constructor.observedAttributes=Object.keys(n).map(w),Object.keys(n).forEach(e=>{const s=n[e],o=w(e);Object.defineProperty(i,e,{get(){if(t._propsCache.has(e))return t._propsCache.get(e);const n=t.getAttribute(o),i=null!==n?b(n,s.type):s.default;return s.required&&null==i&&console.warn(`Required prop '${e}' is missing on ${t.tagName}`),s.validator&&!s.validator(i)&&console.warn(`Invalid prop '${e}' value:`,i),t._propsCache.set(e,i),i},set(n){if(s.validator&&!s.validator(n))return void console.warn(`Invalid prop '${e}' value:`,n);const i=b(n,s.type);t.setAttribute(o,i)}})}),t._props=i,i}(t,e),computed:t=>function(t,e){return new v(t,e)}(t),render(e){t._template=e,t.isConnected&&t._scheduleUpdate()},onMounted(e){t.isConnected?e():t.addEventListener("mounted",e,{once:!0})},onUpdated(e){t.addEventListener("updated",e)},onBeforeUpdate(e){t.addEventListener("beforeUpdate",e)},onUnmounted(e){t.addEventListener("unmounted",e)}}}l.prototype.brand=e,l.prototype.h=function(){return!0},l.prototype.S=function(t){const e=this.t;e!==t&&void 0===t.e&&(t.x=e,this.t=t,void 0!==e?e.e=t:o(()=>{var t;null==(t=this.W)||t.call(this)}))},l.prototype.U=function(t){if(void 0!==this.t){const e=t.e,n=t.x;void 0!==e&&(e.x=n,t.e=void 0),void 0!==n&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n,void 0===n&&o(()=>{var t;null==(t=this.Z)||t.call(this)}))}},l.prototype.subscribe=function(t){return C(()=>{const e=this.value,n=i;i=void 0;try{t(e)}finally{i=n}})},l.prototype.valueOf=function(){return this.value},l.prototype.toString=function(){return this.value+""},l.prototype.toJSON=function(){return this.value},l.prototype.peek=function(){const t=i;i=void 0;try{return this.value}finally{i=t}},Object.defineProperty(l.prototype,"value",{get(){const t=u(this);return void 0!==t&&(t.i=this.i),this.v},set(t){if(t!==this.v){if(h>100)throw new Error("Cycle detected");this.v=t,this.i++,c++,r++;try{for(let t=this.t;void 0!==t;t=t.x)t.t.N()}finally{n()}}}}),v.prototype=new l,v.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if(32==(36&this.f))return!0;if(this.f&=-5,this.g===c)return!0;if(this.g=c,this.f|=1,this.i>0&&!a(this))return this.f&=-2,!0;const t=i;try{f(this),i=this;const t=this.x();(16&this.f||this.v!==t||0===this.i)&&(this.v=t,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return i=t,p(this),this.f&=-2,!0},v.prototype.S=function(t){if(void 0===this.t){this.f|=36;for(let t=this.s;void 0!==t;t=t.n)t.S.S(t)}l.prototype.S.call(this,t)},v.prototype.U=function(t){if(void 0!==this.t&&(l.prototype.U.call(this,t),void 0===this.t)){this.f&=-33;for(let t=this.s;void 0!==t;t=t.n)t.S.U(t)}},v.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(let t=this.t;void 0!==t;t=t.x)t.t.N()}},Object.defineProperty(v.prototype,"value",{get(){if(1&this.f)throw new Error("Cycle detected");const t=u(this);if(this.h(),void 0!==t&&(t.i=this.i),16&this.f)throw this.v;return this.v}}),m.prototype.c=function(){const t=this.S();try{if(8&this.f)return;if(void 0===this.x)return;const t=this.x();"function"==typeof t&&(this.u=t)}finally{t()}},m.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,_(this),f(this),r++;const t=i;return i=this,S.bind(this,t)},m.prototype.N=function(){2&this.f||(this.f|=2,this.o=s,s=this)},m.prototype.d=function(){this.f|=8,1&this.f||y(this)},m.prototype.dispose=function(){this.d()};const L=new Map,x=[];let U=new Set,T=!1;function H(t,e){if(L.has(t))return console.warn(`Component ${t} already registered`),L.get(t);class n extends HTMLElement{static properties={};constructor(){super(),this._reactives=new Map,this._eventHandlers=new Set,this._eventListeners=new Set,this._eventCounter=0,this._template=null,this._lastHTML="",this._firstRender=!0,this._updateScheduled=!1,this._originalContent=null,this._namedSlots={},this._hasSlots=!1,this._defaultSlotContent="",this._processedSlotsCache=null,this._slotsVersion=0,this._lastSlotContent=null;const t=E(this),n=x.reduce((t,e)=>e(t,this)||t,t);e.call(n,n)}connectedCallback(){this._scheduleUpdate(),this.dispatchEvent(new CustomEvent("mounted"))}disconnectedCallback(){this._eventListeners.forEach(({element:t,type:e,handler:n})=>{try{t.removeEventListener(e,n)}catch{}}),this._eventListeners.clear(),this._eventHandlers.forEach(t=>{delete this[t]}),this._eventHandlers.clear(),this._reactives.forEach((t,e)=>{e&&"function"==typeof e.dispose&&e.dispose()}),this._reactives.clear(),this.dispatchEvent(new CustomEvent("unmounted"))}attributeChangedCallback(t,e,n){e!==n&&(this._propsCache&&this._propsCache.delete(this._kebabToCamel(t)),this._scheduleUpdate())}_kebabToCamel(t){return t.replace(/-([a-z])/g,(t,e)=>e.toUpperCase())}_scheduleUpdate(){!this._updateScheduled&&this.isConnected&&(this._updateScheduled=!0,function(t){U.add(t),T||(T=!0,requestAnimationFrame(()=>{const t=[...U];U.clear(),T=!1,t.sort((t,e)=>{const n=t._isVisible();return e._isVisible()-n}),t.forEach(t=>{t.isConnected&&t._render()})}))}(this))}_render(){if(this._template){this._updateScheduled=!1,this.dispatchEvent(new CustomEvent("beforeUpdate"));try{const t="function"==typeof this._template?this._template():String(this._template);if(t===this._lastHTML&&!this._firstRender)return;const i=this._processSlots(t);n=i,(e=this).innerHTML!==n&&(e.innerHTML=n),this._lastHTML=t,this._firstRender=!1,this.dispatchEvent(new CustomEvent("updated"))}catch(e){console.error(`Error rendering ${t}:`,e)}var e,n}}_processSlots(t){const e=this.innerHTML;if(this._firstRender&&!this._originalContent?(this._originalContent=e,this._lastSlotContent=e,this._namedSlots=this._extractNamedSlots(),this._hasSlots=t.includes("<slot"),this._defaultSlotContent=this._getDefaultSlotContent(),this._slotsVersion++):e!==this._lastSlotContent&&(this._lastSlotContent=e,this._namedSlots=this._extractNamedSlots(),this._defaultSlotContent=this._getDefaultSlotContent(),this._slotsVersion++,this._processedSlotsCache=null),!this._hasSlots)return t;if(this._processedSlotsCache&&this._processedSlotsCache.version===this._slotsVersion)return this._processedSlotsCache.result;const n=t.replace(/<slot(\s+name=["']([^"']+)["'])?[^>]*><\/slot>/g,(t,e,n)=>n?this._namedSlots[n]||"":this._defaultSlotContent);return this._processedSlotsCache={version:this._slotsVersion,result:n},n}_extractNamedSlots(){const t={},e=this._lastSlotContent||this._originalContent;if(!e)return t;if(!e.includes("slot="))return t;const n=document.createElement("div");return n.innerHTML=e,n.querySelectorAll("[slot]").forEach(e=>{const n=e.getAttribute("slot");t[n]=e.outerHTML}),t}_getDefaultSlotContent(){const t=this._lastSlotContent||this._originalContent;if(!t)return"";if(!t.includes("slot="))return t;const e=document.createElement("div");return e.innerHTML=t,e.querySelectorAll("[slot]").forEach(t=>t.remove()),e.innerHTML}_isVisible(){if(!this.isConnected)return!0;try{const t=this.getBoundingClientRect();return t.top<window.innerHeight&&t.bottom>0}catch{return!0}}forceUpdate(){this._scheduleUpdate()}}return customElements.define(t,n),L.set(t,n),n}function M(t){"function"==typeof t&&x.push(t)}function N(t,e){return H(t,e)}"undefined"!=typeof window&&(window.component=N,window.TronComponent={component:N,use:M}),t.component=N,t.use=M});
